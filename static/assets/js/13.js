webpackJsonp([13],{Dlta:function(e,t){},"t+jo":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i("BO1k"),o=i.n(a),l=i("mvHQ"),s=i.n(l),n=i("cMGX"),r=i("l0np"),m=i("rM4U"),c=(i("CaOM"),{components:{pagination:n.a,"new-edit":r.a},data:function(){return{tableHeight:window.innerHeight-248,headers:{},is_select_all:!1,firm_options:[],drawer:!1,inputEmpName:"",title:"",dialogAction:"",activeName:"first",width:"40%",institutionValue:void 0,empName:"",empRole:"",empInstitution:"",empScore:"",empMajor:"",empCertification:"",labelPosition:"right",totalNumber:0,currentPage:1,pageSize:10,loadingEmployee:!1,loadingLeft:!1,loadingRight:!1,cacheLeftData:[],cacheRightData:[],data:[],multipleSelection:[],leftData:[],rightData:[],formEmployee:{name:"",role:"",institution:"",score:"",major:"",certification:"",ID_card:"",phone_number:""},options:[{value:"选项1",label:"嘉为"},{value:"选项2",label:"中软"},{value:"选项3",label:"腾讯"}],value:"",rulesGroups:{name:[{required:!0,message:"请输入姓名"},{max:20,message:"长度在20个字符之内"},{validator:m.b}],ID_card:[{required:!0,message:"请输入身份证号"},{max:20,message:"长度在20个字符之内"},{validator:m.c}],phone_number:[{required:!0,message:"请输入手机号"},{max:11,message:"请输入正确的手机号"},{validator:m.a}],role:[{required:!0,message:"请输入职位"},{validator:m.b}],institution:[{required:!0,message:"请输入外协机构"},{validator:m.b}],score:[{required:!0,message:"请输入成绩"}],major:[{required:!0,message:"请输入专业"},{max:14,message:"长度在14个字符之内"},{validator:m.b}],certification:[{required:!0,message:"请输入证书"},{max:14,message:"长度在14个字符之内"},{validator:m.b}]}}},created:function(){this.getEmployee(),this.get_firm();var e=new RegExp("csrftoken=([^;.]*).*$");this.headers={"X-CSRFToken":null===document.cookie.match(e)?null:document.cookie.match(e)[1]}},methods:{handleRemove:function(e,t){console.log(e,t)},handlePreview:function(e){console.log(e)},downTemplate:function(){window.location.href=window.siteUrl+"person/api/employee/download_template/"},select_all:function(e){this.is_select_all=!this.is_select_all},get_firm:function(e){var t=this;this.$store.dispatch("operationfirm/getFirm",{}).then(function(e){t.firm_options=e.items})},search:function(){var e=this,t={page:this.currentPage,page_size:this.pageSize,name:this.inputEmpName,role:this.empRole,omit:"menus,permissions"};this.loadingEmployee=!0,this.$store.dispatch("employee/getEmployee",t).then(function(t){t.count,e.loadingEmployee=!1,e.data=t.items,e.totalNumber=t.count})},getEmployee:function(){var e=this,t={page:this.currentPage,page_size:this.pageSize};this.$store.dispatch("employee/getEmployee",t).then(function(t){console.log(t),t.count>0&&(e.data=t.items,e.totalNumber=t.count)})},pageSizeChange:function(e){this.currentPage=e.currentPage,this.pageSize=e.pageSize,this.search({page:this.currentPage,page_size:this.pageSize})},reset:function(){this.inputEmpName="",this.search()},handleEdit:function(e){this.activeName="first",this.dialogAction="edit",this.title="编辑",this.$refs.newEdit.open(),this.formEmployee=JSON.parse(s()(e.row)),this.formEmployee.users=this.formEmployee.users.map(function(e){return e.id}),this.rightData=e.row.users,this.leftData=[],this.getLeftUser()},leaveTab:function(e){var t=!0;return this.$refs.refformEmployee.validate(function(e){t=!!e}),t},handleNew:function(){var e=this;this.activeName="first",this.dialogAction="new",this.title="添加",this.$refs.newEdit.open(),this.$nextTick(function(){e.$refs.refformEmployee.clearValidate()}),this.leftData=[],this.rightData=[],this.getLeftUser(),this.formEmployee={}},handleImport:function(){var e=this;this.activeName="first",this.dialogAction="import",this.title="导入用户信息",this.$refs.newImport.open(),this.$nextTick(function(){e.$refs.refformEmployee.clearValidate()}),this.leftData=[],this.rightData=[],this.getLeftUser(),this.formEmployee={}},handleExport:function(){if(0!=this.multipleSelection.length){this.is_select_all;var e=this.multipleSelection.map(function(e){return e.id});window.location.href=window.siteUrl+"person/api/employee/export_employee_info/?is_checkedall="+this.is_select_all+"&ids="+e}else this.$message({type:"error",message:"请选择！"})},handleUpdate:function(){var e=this;this.activeName="first",this.dialogAction="new",this.title="编辑",this.$refs.newUpdate.open(),this.$nextTick(function(){e.$refs.refformEmployee.clearValidate()}),this.leftData=[],this.rightData=[],this.getLeftUser(),this.formEmployee={}},handleDeleteAll:function(){var e=this;0!=this.multipleSelection.length?this.$confirm("是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var t={is_checkedall:e.is_select_all,ids:e.multipleSelection.map(function(e){return e.id})};console.log("params"),e.$store.dispatch("employee/batchDeteleEmployee",t).then(function(t){0==t.result?e.$message({type:"error",message:"删除失败"}):(e.search(),e.$message({type:"success",message:"删除成功"}))})}):this.$message({type:"error",message:"请选择！"})},handleSelectionChange:function(e){this.multipleSelection=e},checkboxChange:function(e){var t=this,i=e.is_enable?"是否启用":"是否禁用";this.$confirm(i,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){if(1==e.is_enable){var i={groups:[e.id],enable:!0};t.$store.dispatch("group/groupsStatus",i).then(function(i){i.result?t.$message({type:"success",message:"禁用成功"}):(e.is_enable=!e.is_enable,t.$message({type:"error",message:"禁用失败"}))})}else if(0==e.is_enable){var a={groups:[e.id],enable:!1};t.$store.dispatch("group/groupsStatus",a).then(function(i){i.result?t.$message({type:"success",message:"启用成功"}):(e.is_enable=!e.is_enable,t.$message({type:"error",message:"启用失败"}))})}}).catch(function(){e.is_enable=!e.is_enable,t.$message({type:"info",message:"调取接口失败"})})},handleAuthority:function(e){this.$router.push(e)},handleDetail:function(e){this.drawer=!0,this.formEmployee=e,console.log(e)},transferto:function(){this.$router.replace("/task_list")},handleSuccess:function(e){var t=this;if("new"==this.dialogAction){var i={name:this.formEmployee.name,role:this.formEmployee.role,institution:this.formEmployee.institution,score:this.formEmployee.score,major:this.formEmployee.major,certification:this.formEmployee.certification,ID_card:this.formEmployee.ID_card,phone_number:this.formEmployee.phone_number};this.$store.dispatch("employee/addEmployee",i).then(function(e){0==e.result?t.$message({type:"error",message:"新建失败！"}):(t.search(),t.$message({type:"success",message:"新建成功"})),console.log(e)}).catch(function(){t.$message({type:"info",message:"接口调用失败"})})}else if("edit"==this.dialogAction){this.rightDataId=this.rightData.map(function(e){return e.id}),this.formEmployee.users=this.rightDataId;for(var a=0;a<this.firm_options.length;a++)this.firm_options[a].name==this.formEmployee.institution&&(this.formEmployee.institution=this.firm_options[a].id);var o=this.formEmployee;this.$store.dispatch("employee/modifyEmployee",o).then(function(e){0==e.result?t.$message({type:"error",message:"编辑失败"}):(t.search(),t.$message({type:"success",message:"编辑成功"}))}).catch(function(){t.$message({type:"info",message:"接口调用失败"})})}else this.dialogAction;this.$refs.newEdit.cancel()},handleDelete:function(e){var t=this;this.$confirm("是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var i={id:e.row.id};t.$store.dispatch("employee/deteleEmployee",i).then(function(e){0==e.result?t.$message({type:"error",message:"删除失败"}):(t.search(),t.$message({type:"success",message:"删除成功"}))})}).catch(function(){t.$message({type:"info",message:"已取消"})})},getLeftUser:function(){var e=this;this.$store.dispatch("group/getAllUser").then(function(t){t.result&&("new"==e.dialogAction?e.leftData=t.data:"edit"==e.dialogAction&&(e.leftData=t.data.filter(function(t){var i=!0,a=!1,l=void 0;try{for(var s,n=o()(e.rightData);!(i=(s=n.next()).done);i=!0){var r=s.value;if(t.id==r.id)return!1}}catch(e){a=!0,l=e}finally{try{!i&&n.return&&n.return()}finally{if(a)throw l}}return!0})))})},turnRightItems:function(){this.rightData.push.apply(this.rightData,this.cacheLeftData);var e=0,t=!0,i=!1,a=void 0;try{for(var l,s=o()(this.cacheLeftData);!(t=(l=s.next()).done);t=!0){var n=l.value;this.leftData.splice(n.rowIndex-e,1),e++}}catch(e){i=!0,a=e}finally{try{!t&&s.return&&s.return()}finally{if(i)throw a}}this.cacheLeftData=[]},turnLeftItems:function(){this.leftData.push.apply(this.leftData,this.cacheRightData);var e=0,t=!0,i=!1,a=void 0;try{for(var l,s=o()(this.cacheRightData);!(t=(l=s.next()).done);t=!0){var n=l.value;this.rightData.splice(n.indexRight-e,1),e++}}catch(e){i=!0,a=e}finally{try{!t&&s.return&&s.return()}finally{if(i)throw a}}this.cacheRightData=[]},handleLeftChange:function(e){this.cacheLeftData=e},handleRightChange:function(e){this.cacheRightData=e},leftRow:function(e){var t=e.row,i=e.rowIndex;t.rowIndex=i},rightRow:function(e){var t=e.row,i=e.rowIndex;t.rowIndex=i},upload_success:function(e,t,i){console.log(),this.search(i),this.$refs.newImport.cancel()}},computed:{leftButtonColor:function(){return 0!=this.leftData.length},rightButtonColor:function(){return 0!=this.rightData.length}}}),p={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"employee"},[i("el-button",{on:{click:e.transferto}},[e._v("任务列表页")]),e._v(" "),i("div",{staticClass:"search"},[i("span",{staticClass:"aglin"},[e._v("姓名：")]),e._v(" "),i("el-input",{staticClass:"aglin-input",staticStyle:{width:"30%"},attrs:{size:"mini",clearable:"",placeholder:"请输入内容"},model:{value:e.inputEmpName,callback:function(t){e.inputEmpName=t},expression:"inputEmpName"}}),e._v(" "),i("el-button",{attrs:{size:"mini",type:"primary"},nativeOn:{click:function(t){return e.search(t)}}},[e._v("查询")]),e._v(" "),i("el-button",{attrs:{size:"mini"},nativeOn:{click:function(t){return e.reset(t)}}},[e._v("重置")]),e._v(" "),i("div",{staticClass:"new",staticStyle:{float:"right","margin-bottom":"20px"}},[i("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.handleNew}},[e._v("添加")]),e._v(" "),i("el-button",{attrs:{size:"mini",type:"primary",id:"deleteAll"},on:{click:e.handleDeleteAll}},[e._v("删除\n            ")]),e._v(" "),i("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.handleImport}},[e._v("导入")]),e._v(" "),i("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.handleExport}},[e._v("导出")])],1)],1),e._v(" "),i("div",{staticClass:"table"},[i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingEmployee,expression:"loadingEmployee"}],ref:"",staticStyle:{width:"100%"},attrs:{"row-key":"id",stripe:"",data:e.data,height:e.tableHeight},on:{"select-all":e.select_all,"selection-change":e.handleSelectionChange}},[i("el-table-column",{attrs:{"reserve-selection":"",type:"selection","show-overflow-tooltip":""}}),e._v(" "),i("el-table-column",{attrs:{prop:"name",label:"姓名","show-overflow-tooltip":""}}),e._v(" "),i("el-table-column",{attrs:{prop:"role",label:"职位","show-overflow-tooltip":""}}),e._v(" "),i("el-table-column",{attrs:{prop:"institution",label:"外协机构","show-overflow-tooltip":""}}),e._v(" "),i("el-table-column",{attrs:{prop:"score",label:"成绩","show-overflow-tooltip":""}}),e._v(" "),i("el-table-column",{attrs:{prop:"major",label:"专业","show-overflow-tooltip":""}}),e._v(" "),i("el-table-column",{attrs:{prop:"certification",label:"证书","show-overflow-tooltip":""}}),e._v(" "),i("el-table-column",{attrs:{prop:"handle",label:"操作",fixed:"right",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{type:"text"},on:{click:function(i){e.handleEdit(t)}}},[e._v("编辑")]),e._v(" "),i("el-button",{attrs:{type:"text"},on:{click:function(i){e.handleDetail(t.row)}}},[e._v("详情")]),e._v(" "),i("el-button",{attrs:{type:"text"},on:{click:function(i){e.handleDelete(t)}}},[e._v("删除")])]}}])})],1)],1),e._v(" "),i("pagination",{staticStyle:{position:"relative","margin-top":"20px",float:"right"},attrs:{total:e.totalNumber},on:{"page-size-change":e.pageSizeChange}}),e._v(" "),i("div",{staticStyle:{height:"20px"}}),e._v(" "),i("new-edit",{ref:"newEdit",attrs:{title:e.title,"dialog-action":"dialogAction",width:e.width},on:{"handle-success":e.handleSuccess}},[i("div",{attrs:{slot:"dialog-content"},slot:"dialog-content"},[i("el-tabs",{attrs:{"before-leave":e.leaveTab},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[i("el-tab-pane",{attrs:{label:"角色信息",name:"first"}},[i("el-form",{ref:"refformEmployee",attrs:{"label-position":e.labelPosition,"label-width":"120px",model:e.formEmployee,rules:e.rulesGroups}},[i("el-form-item",{attrs:{label:"姓名",prop:"name"}},[i("el-input",{staticClass:"form-content",model:{value:e.formEmployee.name,callback:function(t){e.$set(e.formEmployee,"name",t)},expression:"formEmployee.name"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"身份证号",prop:"ID_card"}},[i("el-input",{staticClass:"form-content",model:{value:e.formEmployee.ID_card,callback:function(t){e.$set(e.formEmployee,"ID_card",t)},expression:"formEmployee.ID_card"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"手机号",prop:"phone_number"}},[i("el-input",{staticClass:"form-content",model:{value:e.formEmployee.phone_number,callback:function(t){e.$set(e.formEmployee,"phone_number",t)},expression:"formEmployee.phone_number"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"职位",prop:"role"}},[i("el-input",{staticClass:"form-content",model:{value:e.formEmployee.role,callback:function(t){e.$set(e.formEmployee,"role",t)},expression:"formEmployee.role"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"外协机构",prop:"institution"}},[i("el-select",{staticStyle:{width:"85%"},attrs:{placeholder:"请选择"},model:{value:e.formEmployee.institution,callback:function(t){e.$set(e.formEmployee,"institution",t)},expression:"formEmployee.institution"}},e._l(e.firm_options,function(e){return i("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1),e._v(" "),i("el-form-item",{attrs:{label:"成绩",prop:"score"}},[i("el-input",{staticClass:"form-content",model:{value:e.formEmployee.score,callback:function(t){e.$set(e.formEmployee,"score",t)},expression:"formEmployee.score"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"专业",prop:"major"}},[i("el-input",{staticClass:"form-content",model:{value:e.formEmployee.major,callback:function(t){e.$set(e.formEmployee,"major",t)},expression:"formEmployee.major"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"证书"}},[i("el-input",{staticClass:"form-content",attrs:{type:"textarea"},model:{value:e.formEmployee.certification,callback:function(t){e.$set(e.formEmployee,"certification",t)},expression:"formEmployee.certification"}})],1)],1)],1)],1)],1)]),e._v(" "),i("new-edit",{ref:"newImport",attrs:{title:e.title,"dialog-action":"dialogAction",width:e.width},on:{"handle-success":e.handleSuccess}},[i("div",{attrs:{slot:"dialog-content"},slot:"dialog-content"},[i("el-tabs",{attrs:{"before-leave":e.leaveTab},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[i("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.downTemplate}},[e._v("下载模板")]),e._v(" "),i("el-upload",{staticClass:"upload-demo",staticStyle:{display:"inline"},attrs:{name:"employee_file",action:"/person/api/employee/import_employee_info/","on-preview":e.handlePreview,"on-remove":e.handleRemove,"on-success":e.upload_success,multiple:"",headers:e.headers,limit:10}},[i("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击上传")])],1)],1)],1)]),e._v(" "),i("new-edit",{ref:"newUpdate",attrs:{title:e.title,"dialog-action":"dialogAction",width:e.width},on:{"handle-success":e.handleSuccess}},[i("div",{attrs:{slot:"dialog-content"},slot:"dialog-content"},[i("el-tabs",{attrs:{"before-leave":e.leaveTab},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[i("el-tab-pane",{attrs:{label:"角色信息",name:"first"}},[i("el-form",{ref:"refformEmployee",attrs:{"label-position":e.labelPosition,"label-width":"120px",model:e.formEmployee,rules:e.rulesGroups}},[i("el-form-item",{attrs:{label:"姓名",prop:"name"}},[i("el-input",{staticClass:"form-content",model:{value:e.formEmployee.name,callback:function(t){e.$set(e.formEmployee,"name",t)},expression:"formEmployee.name"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"职位",prop:"display_name"}},[i("el-input",{staticClass:"form-content",model:{value:e.formEmployee.role,callback:function(t){e.$set(e.formEmployee,"role",t)},expression:"formEmployee.role"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"外协机构",prop:"display_name"}},[i("el-select",{staticClass:"form-content",attrs:{placeholder:"请选择"},model:{value:e.formEmployee.institution,callback:function(t){e.$set(e.formEmployee,"institution",t)},expression:"formEmployee.institution"}},e._l(e.firm_options,function(e){return i("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1),e._v(" "),i("el-form-item",{attrs:{label:"成绩",prop:"display_name"}},[i("el-input",{staticClass:"form-content",model:{value:e.formEmployee.score,callback:function(t){e.$set(e.formEmployee,"score",t)},expression:"formEmployee.score"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"证书"}},[i("el-input",{staticClass:"form-content",attrs:{type:"textarea"},model:{value:e.formEmployee.certification,callback:function(t){e.$set(e.formEmployee,"certification",t)},expression:"formEmployee.certification"}})],1)],1)],1)],1)],1)]),e._v(" "),i("el-drawer",{attrs:{size:"40%",title:"详情",visible:e.drawer},on:{"update:visible":function(t){e.drawer=t}}},[i("div",{staticClass:"demo-drawer__content",staticStyle:{margin:"5% 5%"}},[i("el-form",{attrs:{inline:!0,model:e.formEmployee,"label-position":e.labelPosition,"label-width":"100px"}},[i("el-form-item",{staticStyle:{width:"45%"},attrs:{label:"姓名："}},[i("span",[e._v(e._s(e.formEmployee.name))])]),e._v(" "),i("el-form-item",{staticStyle:{width:"50%"},attrs:{label:"身份证号："}},[i("span",[e._v(e._s(e.formEmployee.ID_card))])]),e._v(" "),i("el-form-item",{staticStyle:{width:"45%"},attrs:{label:"手机号："}},[i("span",[e._v(e._s(e.formEmployee.phone_number))])]),e._v(" "),i("el-form-item",{staticStyle:{width:"50%"},attrs:{label:"职位："}},[i("span",[e._v(e._s(e.formEmployee.role))])]),e._v(" "),i("el-form-item",{staticStyle:{width:"45%"},attrs:{label:"外协机构："}},[i("span",[e._v(e._s(e.formEmployee.institution))])]),e._v(" "),i("el-form-item",{staticStyle:{width:"50%"},attrs:{label:"成绩："}},[i("span",[e._v(e._s(e.formEmployee.score))])]),e._v(" "),i("el-form-item",{staticStyle:{width:"45%"},attrs:{label:"专业："}},[i("span",[e._v(e._s(e.formEmployee.major))])]),e._v(" "),i("el-form-item",{staticStyle:{width:"50%"},attrs:{label:"证书："}},[i("span",[e._v(e._s(e.formEmployee.certification))])])],1)],1)])],1)},staticRenderFns:[]};var f=i("VU/8")(c,p,!1,function(e){i("Dlta")},null,null);t.default=f.exports}});
//# sourceMappingURL=13.js.map